<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>TimeLog</title>
	<link rel="stylesheet" th:href="@{/css/time-log.css}">
	<script src="https://kit.fontawesome.com/bc53ec41b9.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

</head>

<body>
	<!-- ------------検索---------------- -->
	<header>
		<div class="logo">
			<img th:src="@{../images/logo2.png}">
		</div>
		<div class="header-right">

			<div class="user">

				ユーザ<i class="fa-solid fa-user"></i>：<span sec:authentication="principal.username"></span>

				<form th:action="@{/logout}" method="post">
					<input type="submit" value="ログアウト&#xf08b" />
				</form>
			</div>
		</div>
		<div class="sp-menu">
			<span id="open"><i class="fa-solid fa-user"></i></span>

		</div>
		<div class="list">
			<span id="close"><i class="fa-solid fa-xmark"></i></span>
			ユーザ：<span sec:authentication="principal.username"></span>
			<form th:action="@{/logout}" method="post">
				<input type="submit" value="ログアウト&#xf08b" />
			</form>

		</div>



	</header>



	<main>
		<div th:if="${timeLogList} != null" class="container">



			<div class="day">

				<form th:action="@{/prev-day}" method="POST">
					<button><i class="bi bi-caret-left-fill"></i></button>
				</form>

				<h2 th:text="${timeRegistForm.toDay}" id="date"></h2>

				<form th:action="@{/next-day}" method="POST">
					<button><i class="bi bi-caret-right-fill"></i></button>

				</form>



			</div>

			<div class="log">
				


				<table class="timeLogList">
					<tr style="background-color: rgba(193, 193, 191,0.8);">

						<th>カテゴリー</th>
						<th>開始時間</th>
						<th>終了時間</th>
					</tr>
					<tr th:each="time : ${timeLogList}">

						<td>
							<form th:action="@{/log-detail}" method="POST">
								<input type="hidden" name="toDay" th:value="${timeRegistForm.toDay}">
								<input type="hidden" name="logId" th:value="${time.logId}">
								<button><span th:text="${time.categoryName}"></span></button>
							</form>
						</td>
						<td th:text="${#temporals.format(time.startTime, 'HH:mm')}"></td>
						<td th:text="${#temporals.format(time.endTime, 'HH:mm')}"></td>


					</tr>
					<form>
						<!--					<tr>-->
						<!--						<td id="category"><input type="text"></td>-->
						<!--						<td id="start-time"><input type="text"></td>-->
						<!--						<td id="end-time"><input type="text"></td>-->
						<!--					</tr>-->
						<tr>
							<td colspan="3">
								<div id="regist-btn" class="hidden">新規ログ登録</div>
							</td>
						</tr>
					</form>

				</table>
				<div id="mask" class="hidden"></div>


				<div id="modal" class="hidden">

					<!--					ログ登録モーダルウィンドウ-->
					<div id="regist-modal">
						<h2>ログ登録</h2>
						<div th:if="${errorMessage != null}">
							<span id="errorMessage"></span>
						</div>
						<!--						<form th:action="@{/category-list}" method="POST" th:object="${timeRegistForm}">-->
						<!--							<input type="hidden" th:field="*{maxDay}">-->
						<!--							<input type="hidden" th:field="*{toDay}">-->
						<!--							<input type="submit" value="カテゴリー編集" class="btn">-->
						<!--						</form>-->

						<form th:action="@{/time-regist}" method="POST" th:object="${timeRegistForm}">
							<input type="hidden" th:field="*{maxDay}">
							<input type="hidden" th:field="*{toDay}">
							<table class="detail-table">

								<tr>
									<td class="guide">【カテゴリー名】</td>
									<td>
										<select th:field="*{categoryId}">
											<option th:each="category : ${categoryList}"
												th:value="${category.categoryId}" th:text="${category.categoryName}"
												th:selected="${category.categoryId == categoryId}">
											</option>
										</select>
										<div th:if="${#fields.hasErrors('categoryId')}" th:errors="*{categoryId}"
											class="error-msg" id="categoryErr"></div>
									</td>
									<td>
										<div id="category-edit"><i class="fa-solid fa-gear"></i></div>
									</td>

								</tr>
								<tr>
									<td class="guide">【開始時間】</td>
									<td>
										<input type="datetime-local" name="startTime" th:value="*{maxDay}"><br>
										<div th:if="${#fields.hasErrors('startTime')}" th:errors="*{startTime}"
											class="error-msg" id="startErr"></div>
										<div th:if="${#fields.hasErrors('maxDay')}" th:errors="*{maxDay}"
											class="error-msg" id="maxErr">
										</div>
									</td>
								</tr>
								<tr>
									<td class="guide">【終了時間】</td>
									<td>
										<input type="datetime-local" th:field="*{endTime}"><br>
										<div th:if="${#fields.hasErrors('endTime')}" th:errors="*{endTime}"
											class="error-msg" id="endErr"></div>
									</td>
								</tr>

							</table>

							<div class="log-regist-btn">

								<input type="submit" value="登録" class="btn">
							</div>

						</form>

						<br>
						<div id="close-btn">閉じる</div>

					</div>


					<!--					カテゴリーモーダルウィンドウ-->

					<div id="category-modal" class="hidden">
						
						<div th:if="${categoryEditMode != null}">
							<span id="categoryEditMode"></span>
						</div>


						<div th:if="${categoryList} != null">
							<h2>カテゴリ一覧</h2>









							<table class="timeLogList">

								<tr th:each="category : ${categoryList}">
									<td th:text="${category.categoryName}"></td>


									<td>
										<form th:action="@{/category-show-edit}" method="POST"
											th:object="${timeRegistForm}">
											<input type="hidden" name="categoryId" th:value="${category.categoryId}">

											<input type="submit" value="編集" class="category-edit-btn">
										</form>
									</td>
									<td>
										<form th:action="@{/category-remove}" method="POST">

											<input type="hidden" name="categoryId" th:value="${category.categoryId}">
											<input type="submit" value="削除" class="tbtn">
										</form>
									</td>



								</tr>


							</table>
							<div id="category-add-btn" colgroup span="3">カテゴリー追加</div>
							<div id="category-back-btn">戻る</div>


						</div>











					</div>

					<!--					カテゴリー登録モーダルウィンドウ-->

					<div id="category-add-modal" class="hidden">
						<h2>カテゴリー登録</h2>

						<div th:if="${categoryErrorMessage != null}">
							<span id="categoryErrorMessage"></span>
						</div>

						<form th:action="@{/category-regist}" method="POST" th:object="${categoryRegistForm}">

							<table class="detail-table">
								<tr>
									<td class="guide">【カテゴリー名】</td>
									<td>
										<input type="text" th:field="*{categoryName}" id="categoryRegistContent"><br>
										<div th:if="${#fields.hasErrors('categoryName')}" th:errors="*{categoryName}"
											class="error-msg" id="categoryRegistErr">
										</div>
									</td>

								</tr>


							</table>

							<input type="submit" value="登録" class="btn" id="category-regist-btn">

						</form>

						<br>

						<div id="category-regist-back-btn">戻る</div>

					</div>

					<!--					カテゴリー編集モーダルウィンドウ-->
					<div id="category-edit-modal" class="hidden">
						<h2>カテゴリー編集</h2>
						<div th:if="${ categoryEditedMode!= null}">
							<span id="categoryEditedMode"></span>
						</div>



						<form th:action="@{/category-edit}" method="POST" th:object="${categoryEditForm}">
							<input type="hidden" th:field="*{categoryId}">

							<table class="detail-table">
								<tr>
									<td class="guide">【カテゴリー名】</td>
									<td>
										<input type="text" th:field="${category.categoryName}"><br>
										<div th:if="${#fields.hasErrors('categoryName')}" th:errors="*{categoryName}"
											class="error-msg">
										</div>
									</td>
								</tr>


							</table>

							<input type="submit" value="更新" class="btn">

						</form>


						<div id="category-edit-back-btn">戻る</div>



					</div>

				</div>

				</section>


			</div>


		</div>


	</main>


	<script th:src="@{../js/time-log.js}"></script>


</body>

</html>